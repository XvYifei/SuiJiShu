<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6e8efb">
    <title>RandNumber</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            color: #333;
            position: relative;
            transition: background 0.5s ease;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.95);
            transition: background 0.5s ease;
        }
        
        .app-header {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
        }
        
        .app-title {
            font-size: 28px;
            font-weight: 700;
            color: #5e72e4;
            text-shadow: 0 2px 4px rgba(94, 114, 228, 0.2);
            transition: color 0.5s ease;
        }
        
        .random-number {
            font-size: 140px;
            font-weight: 800;
            color: #5e72e4;
            margin: 20px 0;
            text-shadow: 0 4px 10px rgba(94, 114, 228, 0.2);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .animate-number {
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .range-display {
            background: rgba(94, 114, 228, 0.1);
            padding: 12px 24px;
            border-radius: 50px;
            margin-top: 20px;
            font-size: 16px;
            color: #5e72e4;
            font-weight: 500;
            display: flex;
            gap: 10px;
            position: relative;
            z-index: 2;
            backdrop-filter: blur(5px);
            transition: all 0.5s ease;
        }
        
        .instruction {
            position: absolute;
            bottom: 40px;
            left: 0;
            right: 0;
            text-align: center;
            color: #888;
            font-size: 15px;
            padding: 0 20px;
            z-index: 2;
            transition: color 0.5s ease;
        }
        
        .settings-panel {
            position: fixed;
            bottom: -60%;
            left: 0;
            right: 0;
            height: 60%;
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 25px 20px 20px;
            box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.15);
            transition: bottom 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 20;
            overflow-y: auto;
            transition: background 0.5s ease;
        }
        
        .settings-panel.show {
            bottom: 0;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            transition: border-color 0.5s ease;
        }
        
        .settings-header h2 {
            font-size: 22px;
            font-weight: 700;
            color: #5e72e4;
            transition: color 0.5s ease;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #007AFF;
            font-weight: 500;
            padding: 8px 16px;
            cursor: pointer;
            transition: color 0.5s ease;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 16px;
            transition: color 0.5s ease;
        }
        
        .input-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 18px;
            outline: none;
            transition: border-color 0.3s, background 0.5s ease;
            background: #f8f9ff;
        }
        
        .input-group input:focus {
            border-color: #5e72e4;
            box-shadow: 0 0 0 2px rgba(94, 114, 228, 0.2);
        }
        
        .save-btn {
            background: linear-gradient(to right, #5e72e4, #825ee4);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.5s ease;
            box-shadow: 0 4px 15px rgba(94, 114, 228, 0.3);
        }
        
        .save-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(94, 114, 228, 0.3);
        }
        
        .panel-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            transition: background 0.4s ease;
            z-index: 15;
            pointer-events: none;
        }
        
        .panel-overlay.show {
            background: rgba(0, 0, 0, 0.4);
            pointer-events: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            z-index: 200;
            transition: transform 0.4s ease;
            backdrop-filter: blur(10px);
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .add-to-home {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-top: 15px;
            padding: 10px;
            border-top: 1px solid #eee;
            transition: color 0.5s ease, border-color 0.5s ease;
        }
        
        .add-to-home a {
            color: #5e72e4;
            text-decoration: none;
            font-weight: 500;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .add-to-home a:hover {
            background: rgba(94, 114, 228, 0.1);
            text-decoration: underline;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #4a00e0, #8e2de2);
        }
        
        .dark-mode .main-content {
            background: rgba(30, 30, 46, 0.95);
        }
        
        .dark-mode .app-title,
        .dark-mode .random-number {
            color: #a6b0ff;
            text-shadow: 0 2px 4px rgba(166, 176, 255, 0.2);
        }
        
        .dark-mode .range-display {
            background: rgba(166, 176, 255, 0.1);
            color: #a6b0ff;
        }
        
        .dark-mode .instruction {
            color: #aaa;
        }
        
        .dark-mode .settings-panel {
            background: #1e1e2e;
        }
        
        .dark-mode .settings-header {
            border-bottom: 1px solid #333;
        }
        
        .dark-mode .settings-header h2 {
            color: #a6b0ff;
        }
        
        .dark-mode .close-btn {
            color: #a6b0ff;
        }
        
        .dark-mode .input-group label {
            color: #ddd;
        }
        
        .dark-mode .input-group input {
            background: #252536;
            border-color: #444;
            color: #fff;
        }
        
        .dark-mode .save-btn {
            background: linear-gradient(to right, #a6b0ff, #b197fc);
        }
        
        .dark-mode .add-to-home {
            color: #aaa;
            border-top: 1px solid #333;
        }
        
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 90%;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .dark-mode .pwa-install-prompt {
            background: rgba(30, 30, 46, 0.95);
        }
        
        .pwa-install-prompt p {
            font-size: 14px;
            color: #333;
            margin: 0;
        }
        
        .dark-mode .pwa-install-prompt p {
            color: #ddd;
        }
        
        .pwa-install-buttons {
            display: flex;
            gap: 10px;
        }
        
        .pwa-install-btn {
            background: #5e72e4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .pwa-install-btn:hover {
            background: #4a5bd0;
        }
        
        .pwa-dismiss-btn {
            background: transparent;
            color: #888;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark-mode .pwa-dismiss-btn {
            border-color: #555;
            color: #aaa;
        }
        
        .pwa-dismiss-btn:hover {
            background: #f5f5f5;
        }
        
        .dark-mode .pwa-dismiss-btn:hover {
            background: #252536;
        }
        
        @media (max-height: 700px) {
            .random-number {
                font-size: 80px;
            }
            .settings-panel {
                height: 70%;
                bottom: -70%;
            }
        }
        
        @media all and (display-mode: standalone) {
            body {
                overflow: hidden;
            }
            .app-header {
                top: 40px;
            }
            .instruction {
                bottom: 60px;
            }
        }
        
        .cache-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 90%;
            width: 350px;
            text-align: center;
        }
        
        .dark-mode .cache-panel {
            background: #1e1e2e;
        }
        
        .cache-panel h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #5e72e4;
        }
        
        .dark-mode .cache-panel h3 {
            color: #a6b0ff;
        }
        
        .cache-panel p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .cache-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            margin: 5px 0;
            background: rgba(94, 114, 228, 0.15);
            color: #5e72e4;
        }
        
        .cache-status.active {
            background: rgba(52, 168, 83, 0.15);
            color: #34a853;
        }
        
        .cache-status.inactive {
            background: rgba(234, 67, 53, 0.15);
            color: #ea4335;
        }
        
        .dark-mode .cache-status {
            background: rgba(166, 176, 255, 0.25);
            color: #a6b0ff;
        }
        
        .dark-mode .cache-status.active {
            background: rgba(52, 168, 83, 0.25);
            color: #34a853;
        }
        
        .dark-mode .cache-status.inactive {
            background: rgba(234, 67, 53, 0.25);
            color: #ea4335;
        }
        
        .cache-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .cache-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .cache-clear {
            background: #ea4335;
            color: white;
            border: none;
        }
        
        .cache-cancel {
            background: transparent;
            border: 1px solid #ddd;
            color: #333;
        }
        
        .dark-mode .cache-cancel {
            border-color: #555;
            color: #ddd;
        }
        
        .cache-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            backdrop-filter: blur(3px);
        }
        
        .debug-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: white;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="debug-info">v2.0.1</div>
    
    <div class="container">
        <div class="main-content">
            <div class="random-number" id="randomNumber">42</div>
            <div class="range-display">
                <span>范围：</span>
                <span id="minValue">1</span>
                <span>-</span>
                <span id="maxValue">100</span>
            </div>
            
            <div class="instruction">
                <i class="fas fa-hand-pointer"></i> 点击屏幕刷新 • <i class="fas fa-arrow-up"></i> 上滑打开设置
            </div>
        </div>
        
        <div class="panel-overlay" id="panelOverlay"></div>
        
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2><i class="fas fa-sliders-h"></i> 设置范围</h2>
                <button class="close-btn" id="closeSettings">完成</button>
            </div>
            
            <div class="input-group">
                <label for="minInput"><i class="fas fa-arrow-down"></i> 最小值</label>
                <input type="number" id="minInput" value="1">
            </div>
            
            <div class="input-group">
                <label for="maxInput"><i class="fas fa-arrow-up"></i> 最大值</label>
                <input type="number" id="maxInput" value="100">
            </div>
            
            <button class="save-btn" id="saveSettings">
                <i class="fas fa-save"></i> 保存设置
            </button>
            
            <button class="save-btn" id="manageCache" style="background: linear-gradient(to right, #ff9500, #ff5e3a); margin-top: 15px;">
                <i class="fas fa-database"></i> 管理缓存
            </button>
            
            <div class="add-to-home" id="addToHomePrompt">
                <i class="fas fa-mobile-alt"></i> 可<a href="/SuiJiShu/add_to_home_guide.html" target="_blank">添加到主屏幕</a>使用
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">设置已保存</div>
    
    <div class="pwa-install-prompt" id="installPrompt" style="display: none;">
        <p>添加到主屏幕，获得更好的使用体验</p>
        <div class="pwa-install-buttons">
            <button class="pwa-install-btn" id="installBtn">添加</button>
            <button class="pwa-dismiss-btn" id="dismissBtn">取消</button>
        </div>
    </div>
    
    <div class="cache-overlay" id="cacheOverlay"></div>
    <div class="cache-panel" id="cachePanel">
        <h3><i class="fas fa-database"></i> 缓存管理</h3>
        
        <p>当前缓存状态: <span class="cache-status" id="cacheStatus">检测中...</span></p>
        
        <p>网络状态: <span class="cache-status" id="networkState">检测中...</span></p>
        
        <p id="cacheInfo">应用可在离线模式下正常工作</p>
        
        <div class="cache-buttons">
            <button class="cache-btn cache-clear" id="clearCacheBtn">清除缓存</button>
            <button class="cache-btn cache-cancel" id="cacheCancelBtn">取消</button>
        </div>
    </div>
    
    <script>
        // 当前设置
        let minValue = 1;
        let maxValue = 100;
        let deferredPrompt;
        let isOnline = navigator.onLine;
        
        // DOM元素
        const randomNumberEl = document.getElementById('randomNumber');
        const minValueEl = document.getElementById('minValue');
        const maxValueEl = document.getElementById('maxValue');
        const settingsPanel = document.getElementById('settingsPanel');
        const panelOverlay = document.getElementById('panelOverlay');
        const closeSettingsBtn = document.getElementById('closeSettings');
        const saveSettingsBtn = document.getElementById('saveSettings');
        const minInput = document.getElementById('minInput');
        const maxInput = document.getElementById('maxInput');
        const notification = document.getElementById('notification');
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');
        const manageCacheBtn = document.getElementById('manageCache');
        const cachePanel = document.getElementById('cachePanel');
        const cacheOverlay = document.getElementById('cacheOverlay');
        const clearCacheBtn = document.getElementById('clearCacheBtn');
        const cacheCancelBtn = document.getElementById('cacheCancelBtn');
        const cacheStatus = document.getElementById('cacheStatus');
        const networkState = document.getElementById('networkState');
        const cacheInfo = document.getElementById('cacheInfo');
        const addToHomePrompt = document.getElementById('addToHomePrompt');
        
        // 生成随机数
        function generateRandomNumber() {
            randomNumberEl.classList.remove('animate-number');
            void randomNumberEl.offsetWidth;
            randomNumberEl.classList.add('animate-number');
            
            const randomNum = Math.floor(Math.random() * (maxValue - minValue + 1)) + minValue;
            randomNumberEl.textContent = randomNum;
        }
        
        // 更新范围显示
        function updateRangeDisplay() {
            minValueEl.textContent = minValue;
            maxValueEl.textContent = maxValue;
        }
        
        // 暗黑模式检测
        function checkDarkMode() {
            const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const themeColor = isDarkMode ? "#1e1e2e" : "#6e8efb";
            document.querySelector('meta[name="theme-color"]').setAttribute('content', themeColor);
        }
        
        // 检测是否在PWA模式中运行
        function checkPWA() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                                window.navigator.standalone;
            
            if (isStandalone) {
                addToHomePrompt.style.display = 'none';
            }
        }
        
        // 初始化页面
        function init() {
            generateRandomNumber();
            updateRangeDisplay();
            checkDarkMode();
            checkPWA();
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', checkDarkMode);
            
            document.body.addEventListener('click', function(e) {
                if (!settingsPanel.classList.contains('show') && 
                    !cachePanel.style.display) {
                    generateRandomNumber();
                }
            });
            
            let startY = 0;
            let isScrolling = false;
            
            document.body.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
                isScrolling = false;
            });
            
            document.body.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                const diffY = startY - currentY;
                
                if (diffY > 30 && !isScrolling && !settingsPanel.classList.contains('show')) {
                    openSettings();
                    isScrolling = true;
                }
            });
            
            closeSettingsBtn.addEventListener('click', closeSettings);
            saveSettingsBtn.addEventListener('click', saveSettings);
            panelOverlay.addEventListener('click', closeSettings);
            
            installBtn.addEventListener('click', installPWA);
            dismissBtn.addEventListener('click', dismissInstallPrompt);
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                setTimeout(() => {
                    installPrompt.style.display = 'flex';
                }, 3000);
            });
            
            manageCacheBtn.addEventListener('click', openCachePanel);
            cacheCancelBtn.addEventListener('click', closeCachePanel);
            clearCacheBtn.addEventListener('click', clearAppCache);
            cacheOverlay.addEventListener('click', closeCachePanel);
            
            updateNetworkStatus();
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            registerServiceWorker();
        }
        
        // 注册Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                const CACHE_NAME = 'randnumber-pwa-v2';
                const urlsToCache = [
                    location.href,
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                ];
                
                const swScript = `
                    const CACHE_NAME = '${CACHE_NAME}';
                    const urlsToCache = ${JSON.stringify(urlsToCache)};
                    
                    // 安装Service Worker并缓存资源
                    self.addEventListener('install', event => {
                        console.log('Service Worker 安装中...');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('正在缓存核心资源');
                                    return cache.addAll(urlsToCache);
                                })
                                .then(() => {
                                    console.log('所有核心资源已缓存');
                                    return self.skipWaiting();
                                })
                        );
                    });
                    
                    // 激活时清理旧缓存
                    self.addEventListener('activate', event => {
                        console.log('Service Worker 激活');
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.filter(name => name !== CACHE_NAME)
                                        .map(name => {
                                            console.log('删除旧缓存: ', name);
                                            return caches.delete(name);
                                        })
                                );
                            }).then(() => self.clients.claim())
                        );
                    });
                    
                    // 拦截网络请求
                    self.addEventListener('fetch', event => {
                        const requestUrl = new URL(event.request.url);
                        
                        // 对于同源请求，使用缓存优先策略
                        if (requestUrl.origin === location.origin) {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        return response || fetch(event.request);
                                    })
                            );
                        }
                        // 对于字体资源，也使用缓存优先
                        else if (requestUrl.href.includes('fontawesome') || 
                                 requestUrl.href.includes('fonts.gstatic')) {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        return response || fetch(event.request)
                                            .then(networkResponse => {
                                                // 将新资源加入缓存
                                                caches.open(CACHE_NAME)
                                                    .then(cache => {
                                                        cache.put(event.request, networkResponse.clone());
                                                    });
                                                return networkResponse;
                                            });
                                    })
                            );
                        }
                        // 其他请求直接访问网络
                        else {
                            event.respondWith(fetch(event.request));
                        }
                    });
                `;
                
                const blob = new Blob([swScript], {type: 'application/javascript'});
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('Service Worker 注册成功:', registration);
                        
                        // 监听Service Worker状态变化
                        if (registration.installing) {
                            registration.installing.onstatechange = function() {
                                if (this.state === 'activated') {
                                    console.log('Service Worker 已激活');
                                    updateCacheStatus('已启用', true);
                                }
                            };
                        }
                        
                        // 如果已经有激活的Service Worker
                        if (registration.active) {
                            updateCacheStatus('已启用', true);
                        }
                        
                        // 监听更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'activated') {
                                    updateCacheStatus('已启用', true);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker 注册失败:', error);
                        updateCacheStatus('注册失败', false);
                    });
            } else {
                console.log('当前浏览器不支持Service Worker');
                updateCacheStatus('不支持', false);
            }
        }
        
        // 更新缓存状态显示
        function updateCacheStatus(text, isActive) {
            cacheStatus.textContent = text;
            if (isActive) {
                cacheStatus.classList.add('active');
                cacheStatus.classList.remove('inactive');
            } else {
                cacheStatus.classList.add('inactive');
                cacheStatus.classList.remove('active');
            }
        }
        
        // 检查缓存状态
        function checkCacheStatus() {
            if ('caches' in window) {
                caches.has('randnumber-pwa-v2')
                    .then(hasCache => {
                        if (hasCache) {
                            console.log('缓存存在，状态为已启用');
                            updateCacheStatus('已启用', true);
                        } else {
                            console.log('缓存不存在，状态为未启用');
                            updateCacheStatus('未启用', false);
                        }
                    })
                    .catch(error => {
                        console.log('缓存检测失败', error);
                        updateCacheStatus('检测失败', false);
                    });
            } else {
                console.log('浏览器不支持缓存');
                updateCacheStatus('不支持', false);
            }
        }
        
        // 打开缓存管理面板
        function openCachePanel() {
            updateNetworkStatus();
            checkCacheStatus();
            
            if (isOnline) {
                cacheInfo.textContent = '应用已缓存，可在离线模式下正常工作';
            } else {
                cacheInfo.textContent = '离线模式：应用已缓存，可以正常工作';
            }
            
            cachePanel.style.display = 'block';
            cacheOverlay.style.display = 'block';
        }
        
        // 关闭缓存管理面板
        function closeCachePanel() {
            cachePanel.style.display = 'none';
            cacheOverlay.style.display = 'none';
        }
        
        // 清除应用缓存
        function clearAppCache() {
            if ('caches' in window) {
                caches.delete('randnumber-pwa-v2')
                    .then(success => {
                        if (success) {
                            console.log('缓存清除成功');
                            showNotification('缓存已清除');
                            updateCacheStatus('未启用', false);
                            
                            // 重新加载页面以应用更改
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            console.log('缓存清除失败');
                            showNotification('清除缓存失败');
                        }
                    })
                    .catch(error => {
                        console.error('清除缓存失败:', error);
                        showNotification('清除缓存失败: ' + error.message);
                    });
            } else {
                showNotification('浏览器不支持缓存');
            }
        }
        
        // 更新网络状态显示
        function updateNetworkStatus() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                networkState.textContent = '在线';
                networkState.className = 'cache-status active';
            } else {
                networkState.textContent = '离线';
                networkState.className = 'cache-status inactive';
            }
        }
        
        // 打开设置面板
        function openSettings() {
            minInput.value = minValue;
            maxInput.value = maxValue;
            settingsPanel.classList.add('show');
            panelOverlay.classList.add('show');
        }
        
        // 关闭设置面板
        function closeSettings() {
            settingsPanel.classList.remove('show');
            panelOverlay.classList.remove('show');
        }
        
        // 保存设置
        function saveSettings() {
            let newMin = parseInt(minInput.value);
            let newMax = parseInt(maxInput.value);
            
            if (isNaN(newMin) || isNaN(newMax)) {
                showNotification('请输入有效数字');
                return;
            }
            
            if (newMin >= newMax) {
                showNotification('最小值必须小于最大值');
                return;
            }
            
            if (newMax - newMin > 1000000) {
                showNotification('范围过大，请减小差值');
                return;
            }
            
            minValue = newMin;
            maxValue = newMax;
            
            updateRangeDisplay();
            generateRandomNumber();
            closeSettings();
            showNotification('设置已保存');
        }
        
        // 显示通知
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }
        
        // 安装PWA
        function installPWA() {
            installPrompt.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('用户接受安装');
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // 关闭安装提示
        function dismissInstallPrompt() {
            installPrompt.style.display = 'none';
        }
        
        // 初始化应用
        init();
    </script>
</body>
</html>
